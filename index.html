
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Telegram Emoji Splitter</title>
  <style>
    body { font-family: sans-serif; background: #f0f0f0; text-align: center; padding: 20px; }
    .dropzone { border: 2px dashed #007bff; padding: 30px; background: #fff; margin-bottom: 20px; cursor: pointer; }
    canvas { display: none; }
    .tile-container { display: inline-block; margin: 10px; }
    .tile-container img { border: 1px solid #ccc; border-radius: 4px; }
    .tile-container a { display: block; margin-top: 5px; font-size: 12px; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/gifuct-js/dist/gifuct.min.js"></script>
</head>
<body>
  <h1>Telegram Emoji Splitter (Static WebP & Animated TGS-ready)</h1>
  <div class="dropzone" id="dropzone">
    <p>Click or Drop Image/GIF Here</p>
    <input type="file" id="fileInput" accept="image/*" hidden />
  </div>
  <div id="output"></div>
  <canvas id="canvas"></canvas>
  <script>
    const dropzone = document.getElementById('dropzone');
    const fileInput = document.getElementById('fileInput');
    const output = document.getElementById('output');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    dropzone.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', e => handleFile(e.target.files[0]));
    dropzone.addEventListener('dragover', e => {
      e.preventDefault();
      dropzone.style.background = '#e0f7ff';
    });
    dropzone.addEventListener('dragleave', () => dropzone.style.background = '#fff');
    dropzone.addEventListener('drop', e => {
      e.preventDefault();
      dropzone.style.background = '#fff';
      if (e.dataTransfer.files.length > 0) handleFile(e.dataTransfer.files[0]);
    });

    function handleFile(file) {
      output.innerHTML = '';
      if (file.type === 'image/gif') {
        const reader = new FileReader();
        reader.onload = e => {
          const gif = gifuct.parseGIF(e.target.result);
          const frames = gifuct.decompressFrames(gif, true);
          frames.forEach((frame, idx) => {
            const imageData = new ImageData(
              new Uint8ClampedArray(frame.patch),
              frame.dims.width,
              frame.dims.height
            );
            canvas.width = 500;
            canvas.height = 500;
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = frame.dims.width;
            tempCanvas.height = frame.dims.height;
            const tempCtx = tempCanvas.getContext('2d');
            tempCtx.putImageData(imageData, 0, 0);
            ctx.clearRect(0, 0, 500, 500);
            ctx.drawImage(tempCanvas, 0, 0, 500, 500);
            splitImage(canvas, `frame${idx}`);
          });
        };
        reader.readAsArrayBuffer(file);
      } else if (file.type.startsWith('image/')) {
        const img = new Image();
        img.onload = () => {
          canvas.width = 500;
          canvas.height = 500;
          ctx.clearRect(0, 0, 500, 500);
          ctx.drawImage(img, 0, 0, 500, 500);
          splitImage(canvas, 'image');
        };
        img.src = URL.createObjectURL(file);
      } else {
        alert('Unsupported file type.');
      }
    }

    function splitImage(sourceCanvas, prefix) {
      const tileSize = 100;
      for (let y = 0; y < 500; y += tileSize) {
        for (let x = 0; x < 500; x += tileSize) {
          const tileCanvas = document.createElement('canvas');
          tileCanvas.width = tileSize;
          tileCanvas.height = tileSize;
          const tileCtx = tileCanvas.getContext('2d');
          tileCtx.drawImage(sourceCanvas, x, y, tileSize, tileSize, 0, 0, tileSize, tileSize);
          const pngURL = tileCanvas.toDataURL('image/png');
          const webpURL = tileCanvas.toDataURL('image/webp');
          const imgEl = document.createElement('img');
          imgEl.src = pngURL;
          const pngLink = document.createElement('a');
          pngLink.href = pngURL;
          pngLink.download = `${prefix}_tile_${x}_${y}.png`;
          pngLink.textContent = 'Download PNG';
          const webpLink = document.createElement('a');
          webpLink.href = webpURL;
          webpLink.download = `${prefix}_tile_${x}_${y}.webp`;
          webpLink.textContent = 'Download WebP';
          const container = document.createElement('div');
          container.className = 'tile-container';
          container.appendChild(imgEl);
          container.appendChild(pngLink);
          container.appendChild(webpLink);
          output.appendChild(container);
        }
      }
    }
  </script>
</body>
</html>
